<!DOCTYPE html>
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle { stroke: black;} </style>

<body onload='init()'>
<svg id="scene" width=600 height=600>
</svg>


<script>
async function init(){
  const data = await d3.csv(
    'https://flunky.github.io/cars2017.csv');

  var tooltip2 = d3.select("svg")
    .append("div")
    .style("position", "absolute")
    .style("visibility", "hidden")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "1px")
    .style("border-radius", "5px")
    .style("padding", "10px")
    .html("<p>I'm a tooltip written in HTML</p>");


  var xscale = d3.scaleLog().base(10)
    .domain([10,150]).range([0,500]);

  var yscale = d3.scaleLog().base(10)
    .domain([10,150]).range([500,0]);

  var rscale = d3.scaleLinear()
    .domain([0,12]).range([2,14]);

  var fuelColor = {
      'Diesel': 'red',
      'Gasoline': 'blue',
      'Electricity': 'green'
    };

  var fuelOpacity = {
      'Diesel': 1,
      'Gasoline': 0,
      'Electricity': 0
    };

  var blueOpacity = {
      'red': 0,
      'blue': 1,
      'green': 0
    };

  var greenOpacity = {
      'red': 0,
      'blue': 0,
      'green': 1
    };
 


  d3.select("svg").append("g")
   .attr("transform", "translate(50,50)")
   .selectAll("circle").data(data).enter()
    .append("circle")
    .attr('cx', function(d,i){return xscale(d.AverageCityMPG);})
    .attr('cy', 500)
    .attr('r', 4)
    .style('fill', function(d,i){return fuelColor[d.Fuel];})
    .style('opacity', function(d,i){return fuelOpacity[d.Fuel];})
    .transition().duration(3000).delay(1000)
    .attr('cy', function(d,i){return yscale(d.AverageHighwayMPG);})
    .transition().duration(3000).delay(1000)
    .style('opacity', function(d,i){return blueOpacity[d.fill];})
    .transition().duration(3000).delay(1000)
    .style('opacity', function(d,i){return greenOpacity[d.fill];});
 

  d3.selectAll()
    .on("mouseover", function(){return tooltip2.style("visibility", "visible");})
    .on("mousemove", function(){return tooltip2.style("top", (event.pageY-2390)+"px").style("left",(event.pageX-800)+"px");})
    .on("mouseout", function(){return tooltip2.style("visibility", "hidden");});
 
  // Add a diagonal line where Avg Highway MPG = Avg City MPG
  d3.select("svg").append("g")
   .append("line")
    .attr('x1', 0)
    .attr('y1', 600)
    .attr('x2', 600)
    .attr('y2', 0)
    .attr('stroke', 'red')
    .attr('stroke-dash-array', '1, 5');

  // Add the y Axis
  d3.select("svg").append("g")
    .attr("transform", "translate(50,50)")
    .call(d3.axisLeft(yscale)
     .tickValues([10,20,50,100])
     .tickFormat(d3.format("~s")));

  // text label for the y axis
  d3.select("svg").append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 5)
      .attr("x", -300 )
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Avg Highway MPG"); 

  // Add the x Axis
  d3.select("svg").append("g")
   .attr("transform", "translate(50,550)")
   .call(d3.axisBottom(xscale)
     .tickValues([10,20,50,100])
     .tickFormat(d3.format("~s")));

  // text label for the x axis
  d3.select("svg").append("text")             
      .attr("transform",
            "translate(300, 590)")
      .style("text-anchor", "middle")
      .text("Avg City MPG");

}
</script>

</body>
</html>
